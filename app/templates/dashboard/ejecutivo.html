{% extends "base.html" %}

{% block title %}Dashboard Ejecutivo{% endblock %}
{% block page_title %}Dashboard Ejecutivo{% endblock %}

{% block content %}
<!-- KPIs Principales -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <!-- Cumplimiento Compromisos -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-500">Cumplimiento Compromisos</p>
                <p class="text-3xl font-bold 
                    {% if kpis.cumplimiento_compromisos.semaforo == 'VERDE' %}text-green-600
                    {% elif kpis.cumplimiento_compromisos.semaforo == 'AMARILLO' %}text-yellow-600
                    {% elif kpis.cumplimiento_compromisos.semaforo == 'ROJO' %}text-red-600
                    {% else %}text-gray-400{% endif %}">
                    {{ kpis.cumplimiento_compromisos.valor }}%
                </p>
                <p class="text-xs text-gray-400">Meta: {{ kpis.cumplimiento_compromisos.meta }}%</p>
            </div>
            <div class="h-12 w-12 rounded-full flex items-center justify-center
                {% if kpis.cumplimiento_compromisos.semaforo == 'VERDE' %}bg-green-100
                {% elif kpis.cumplimiento_compromisos.semaforo == 'AMARILLO' %}bg-yellow-100
                {% elif kpis.cumplimiento_compromisos.semaforo == 'ROJO' %}bg-red-100
                {% else %}bg-gray-100{% endif %}">
                <svg class="h-6 w-6 
                    {% if kpis.cumplimiento_compromisos.semaforo == 'VERDE' %}text-green-600
                    {% elif kpis.cumplimiento_compromisos.semaforo == 'AMARILLO' %}text-yellow-600
                    {% elif kpis.cumplimiento_compromisos.semaforo == 'ROJO' %}text-red-600
                    {% else %}text-gray-400{% endif %}" 
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Problemas Escalados -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-500">Problemas Escalados</p>
                <p class="text-3xl font-bold
                    {% if kpis.problemas_escalados.semaforo == 'VERDE' %}text-green-600
                    {% elif kpis.problemas_escalados.semaforo == 'AMARILLO' %}text-yellow-600
                    {% elif kpis.problemas_escalados.semaforo == 'ROJO' %}text-red-600
                    {% else %}text-gray-400{% endif %}">
                    {{ kpis.problemas_escalados.valor }}
                </p>
                <p class="text-xs text-gray-400">Meta: {{ kpis.problemas_escalados.meta }}</p>
            </div>
            <div class="h-12 w-12 rounded-full flex items-center justify-center
                {% if kpis.problemas_escalados.semaforo == 'VERDE' %}bg-green-100
                {% elif kpis.problemas_escalados.semaforo == 'AMARILLO' %}bg-yellow-100
                {% elif kpis.problemas_escalados.semaforo == 'ROJO' %}bg-red-100
                {% else %}bg-gray-100{% endif %}">
                <svg class="h-6 w-6 
                    {% if kpis.problemas_escalados.semaforo == 'VERDE' %}text-green-600
                    {% elif kpis.problemas_escalados.semaforo == 'AMARILLO' %}text-yellow-600
                    {% elif kpis.problemas_escalados.semaforo == 'ROJO' %}text-red-600
                    {% else %}text-gray-400{% endif %}" 
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Alertas Cr√≠ticas -->
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm font-medium text-gray-500">Alertas Cr√≠ticas</p>
                <p class="text-3xl font-bold
                    {% if datos.alertas_criticas == 0 %}text-green-600
                    {% elif datos.alertas_criticas <= 3 %}text-yellow-600
                    {% else %}text-red-600{% endif %}">
                    {{ datos.alertas_criticas }}
                </p>
                <p class="text-xs text-gray-400">IPR con problemas: {{ datos.ipr_con_problemas }}</p>
            </div>
            <div class="h-12 w-12 rounded-full flex items-center justify-center
                {% if datos.alertas_criticas == 0 %}bg-green-100
                {% elif datos.alertas_criticas <= 3 %}bg-yellow-100
                {% else %}bg-red-100{% endif %}">
                <svg class="h-6 w-6 
                    {% if datos.alertas_criticas == 0 %}text-green-600
                    {% elif datos.alertas_criticas <= 3 %}text-yellow-600
                    {% else %}text-red-600{% endif %}" 
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Problemas Escalados (detalle) -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Problemas Escalados</h3>
            <p class="mt-1 text-sm text-gray-500">Impacto ALTO o CR√çTICO - Requieren decisi√≥n</p>
        </div>
        <ul class="divide-y divide-gray-200">
            {% for problema in datos.problemas_escalados %}
            <li class="px-4 py-4">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-0.5 text-xs rounded
                                {% if problema.impacto == 'CRITICO' %}bg-red-100 text-red-800
                                {% else %}bg-orange-100 text-orange-800{% endif %}">
                                {{ problema.impacto }}
                            </span>
                            <span class="px-2 py-0.5 text-xs rounded bg-gray-100 text-gray-700">
                                {{ problema.tipo }}
                            </span>
                        </div>
                        <p class="mt-1 text-sm text-gray-900">{{ problema.descripcion }}</p>
                        <p class="mt-1 text-xs text-gray-500">
                            {{ problema.dias_abierto }} d√≠as abierto
                        </p>
                    </div>
                    <a href="{{ url_for('problemas.ver', id=problema.id) }}"
                       class="ml-4 text-indigo-600 hover:text-indigo-500 text-sm">
                        Ver ‚Üí
                    </a>
                </div>
            </li>
            {% else %}
            <li class="px-4 py-8 text-center text-gray-500">
                No hay problemas escalados üéâ
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Compromisos Urgentes -->
    <div class="bg-white rounded-lg shadow">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Compromisos Urgentes</h3>
            <p class="mt-1 text-sm text-gray-500">Vencidos o pr√≥ximos a vencer</p>
        </div>
        <ul class="divide-y divide-gray-200">
            {% for comp in datos.compromisos_urgentes %}
            <li class="px-4 py-4">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-0.5 text-xs rounded
                                {% if comp.prioridad == 'URGENTE' %}bg-red-100 text-red-800
                                {% elif comp.prioridad == 'ALTA' %}bg-orange-100 text-orange-800
                                {% else %}bg-blue-100 text-blue-800{% endif %}">
                                {{ comp.prioridad }}
                            </span>
                            {% if comp.vencido %}
                            <span class="px-2 py-0.5 text-xs rounded bg-red-100 text-red-800 font-semibold">
                                VENCIDO
                            </span>
                            {% endif %}
                        </div>
                        <p class="mt-1 text-sm text-gray-900">{{ comp.descripcion }}</p>
                        <p class="mt-1 text-xs text-gray-500">
                            {{ comp.responsable }}
                            ‚Ä¢ 
                            {% if comp.dias_restantes is not none %}
                                {% if comp.dias_restantes < 0 %}
                                    {{ -comp.dias_restantes }}d vencido
                                {% elif comp.dias_restantes == 0 %}
                                    Vence hoy
                                {% else %}
                                    {{ comp.dias_restantes }}d restantes
                                {% endif %}
                            {% endif %}
                        </p>
                    </div>
                    <a href="{{ url_for('compromisos.ver', id=comp.id) }}"
                       class="ml-4 text-indigo-600 hover:text-indigo-500 text-sm">
                        Ver ‚Üí
                    </a>
                </div>
            </li>
            {% else %}
            <li class="px-4 py-8 text-center text-gray-500">
                No hay compromisos urgentes üéâ
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- Tendencias (√∫ltimos 7 d√≠as) -->
<div class="mt-6 bg-white rounded-lg shadow">
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">Tendencias (√∫ltimos 7 d√≠as)</h3>
    </div>
    <div class="px-4 py-5 sm:p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
                <p class="text-2xl font-bold text-red-600">+{{ datos.tendencias.nuevos_problemas_7d }}</p>
                <p class="text-sm text-gray-500">Nuevos problemas</p>
            </div>
            <div class="text-center">
                <p class="text-2xl font-bold text-green-600">{{ datos.tendencias.problemas_resueltos_7d }}</p>
                <p class="text-sm text-gray-500">Problemas resueltos</p>
            </div>
            <div class="text-center">
                <p class="text-2xl font-bold text-blue-600">{{ datos.tendencias.compromisos_completados_7d }}</p>
                <p class="text-sm text-gray-500">Compromisos completados</p>
            </div>
        </div>
    </div>
</div>

<!-- Alertas activas -->
{% if alertas %}
<div class="mt-6 bg-white rounded-lg shadow">
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">Alertas Activas</h3>
    </div>
    <ul class="divide-y divide-gray-200">
        {% for alerta in alertas %}
        <li class="px-4 py-3 {{ alerta.clase_nivel }} border-l-4">
            <div class="flex items-center justify-between">
                <div>
                    <span class="text-xs font-medium">{{ alerta.tipo }}</span>
                    <p class="text-sm">{{ alerta.mensaje }}</p>
                </div>
                <a href="{{ url_for('alertas.ver', id=alerta.id) }}"
                   class="text-sm text-indigo-600 hover:text-indigo-500">
                    Atender
                </a>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endblock %}
