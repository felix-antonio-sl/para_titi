{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
page_title %}Dashboard de Crisis{% endblock %} {% block content %}
<!-- Estad√≠sticas -->
<div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
  <!-- Total IPR -->
  <div class="bg-white overflow-hidden shadow rounded-lg">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-md bg-indigo-500 p-3">
            <svg
              class="h-6 w-6 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21"
              />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              Total IPR
            </dt>
            <dd class="text-2xl font-semibold text-gray-900">
              {{ stats.total_ipr }}
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- IPR con Problemas -->
  <div class="bg-white overflow-hidden shadow rounded-lg">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-md bg-red-500 p-3">
            <svg
              class="h-6 w-6 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
              />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              IPR con Problemas
            </dt>
            <dd class="text-2xl font-semibold text-red-600">
              {{ stats.ipr_con_problemas }}
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- Compromisos Pendientes -->
  <div class="bg-white overflow-hidden shadow rounded-lg">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-md bg-yellow-500 p-3">
            <svg
              class="h-6 w-6 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              Compromisos Pendientes
            </dt>
            <dd class="text-2xl font-semibold text-gray-900">
              {{ stats.compromisos_pendientes }}
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- Compromisos Vencidos -->
  <div class="bg-white overflow-hidden shadow rounded-lg">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-md bg-orange-500 p-3">
            <svg
              class="h-6 w-6 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"
              />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              Compromisos Vencidos
            </dt>
            <dd class="text-2xl font-semibold text-orange-600">
              {{ stats.compromisos_vencidos }}
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
  <!-- Mis Compromisos -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
      <h3 class="text-lg font-medium leading-6 text-gray-900">
        Mis Compromisos Pendientes
      </h3>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for compromiso in mis_compromisos %}
      <li class="px-4 py-4 hover:bg-gray-50">
        <a
          href="{{ url_for('compromisos.ver', id=compromiso.id) }}"
          class="block"
        >
          <div class="flex items-center justify-between">
            <p class="text-sm font-medium text-indigo-600 truncate">
              {{ compromiso.descripcion[:60] }}{% if
              compromiso.descripcion|length > 60 %}...{% endif %}
            </p>
            <span
              class="ml-2 px-2 py-1 text-xs rounded-full {{ compromiso.clase_estado }}"
            >
              {{ compromiso.estado }}
            </span>
          </div>
          <div class="mt-2 flex items-center text-sm text-gray-500">
            <span
              class="{% if compromiso.esta_vencido() %}text-red-600 font-semibold{% endif %}"
            >
              Vence: {{ compromiso.fecha_limite.strftime('%d/%m/%Y') }} {% if
              compromiso.dias_restantes() is not none %} {% if
              compromiso.dias_restantes() < 0 %} ({{
              -compromiso.dias_restantes() }} d√≠as vencido) {% elif
              compromiso.dias_restantes() == 0 %} (hoy) {% else %} ({{
              compromiso.dias_restantes() }} d√≠as) {% endif %} {% endif %}
            </span>
          </div>
        </a>
      </li>
      {% else %}
      <li class="px-4 py-8 text-center text-gray-500">
        No tienes compromisos pendientes üéâ
      </li>
      {% endfor %}
    </ul>
    {% if mis_compromisos %}
    <div class="px-4 py-3 bg-gray-50 text-right">
      <a
        href="{{ url_for('compromisos.lista', mios=1) }}"
        class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
      >
        Ver todos ‚Üí
      </a>
    </div>
    {% endif %}
  </div>

  <!-- Alertas Activas -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
      <h3 class="text-lg font-medium leading-6 text-gray-900">
        Alertas Activas
      </h3>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for alerta in alertas %}
      <li
        class="px-4 py-4 {{ alerta.clase_nivel }} border-l-4 hover:bg-gray-50 cursor-pointer"
      >
        <a
          href="{{ url_for('ipr.ficha', id=alerta.iniciativa_id) }}"
          class="block"
        >
          <div class="flex items-center justify-between">
            <p
              class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
            >
              {{ alerta.mensaje[:80] }}{% if alerta.mensaje|length > 80 %}...{%
              endif %}
            </p>
            <span class="ml-2 px-2 py-1 text-xs font-semibold rounded"
              >{{ alerta.nivel }}</span
            >
          </div>
          <div class="mt-1 text-xs text-gray-600">
            {{ alerta.tipo }} ¬∑ {{ alerta.generada_en.strftime('%d/%m/%Y %H:%M')
            }}
          </div>
        </a>
      </li>
      {% else %}
      <li class="px-4 py-8 text-center text-gray-500">
        No hay alertas activas ‚úì
      </li>
      {% endfor %}
    </ul>
    {% if alertas %}
    <div class="px-4 py-3 bg-gray-50 text-right">
      <a
        href="{{ url_for('alertas.lista') }}"
        class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
      >
        Ver todas ‚Üí
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% if compromisos_vencidos %}
<!-- Compromisos Vencidos (solo para jefes/admin) -->
<div class="mt-8 bg-white shadow rounded-lg border-l-4 border-red-500">
  <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
    <h3 class="text-lg font-medium leading-6 text-red-600">
      ‚ö†Ô∏è Compromisos Vencidos
    </h3>
  </div>
  <ul class="divide-y divide-gray-200">
    {% for compromiso in compromisos_vencidos %}
    <li class="px-4 py-4 hover:bg-red-50">
      <a
        href="{{ url_for('compromisos.ver', id=compromiso.id) }}"
        class="block"
      >
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-gray-900">
              {{ compromiso.descripcion[:60] }}...
            </p>
            <p class="text-sm text-gray-500">
              Responsable: {{ compromiso.responsable.nombre_completo }}
            </p>
          </div>
          <div class="text-right">
            <span class="text-red-600 font-semibold">
              {{ -compromiso.dias_restantes() }} d√≠as vencido
            </span>
          </div>
        </div>
      </a>
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %} {% if ipr_con_problemas %}
<!-- IPR con Problemas -->
<div class="mt-8 bg-white shadow rounded-lg">
  <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
    <h3 class="text-lg font-medium leading-6 text-gray-900">
      IPR con Problemas Abiertos
    </h3>
  </div>
  <ul class="divide-y divide-gray-200">
    {% for ipr in ipr_con_problemas %}
    <li class="px-4 py-4 hover:bg-gray-50">
      <a href="{{ url_for('ipr.ficha', id=ipr.id) }}" class="block">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-indigo-600">
              {{ ipr.codigo_interno }}
            </p>
            <p class="text-sm text-gray-900">
              {{ ipr.nombre[:60] }}{% if ipr.nombre|length > 60 %}...{% endif %}
            </p>
          </div>
          <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">
            {{ ipr.problemas_abiertos_count }} problema{% if
            ipr.problemas_abiertos_count != 1 %}s{% endif %}
          </span>
        </div>
      </a>
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %} {% endblock %}
